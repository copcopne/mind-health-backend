<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head>
    <title>Chi tiết phản hồi</title>
    <th:block th:replace="~{base :: styles}"></th:block>
</head>

<body class="d-flex flex-column vh-100 bg-light">
    <div th:replace="~{base :: header}"></div>

    <main class="flex-grow-1" style="margin-top: 58px;">
        <div class="container pt-4" th:object="${feedback}">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-xl-7">
                    <div class="card shadow-sm">
                        <div class="card-body p-4">

                            <div th:if="${successMessage}" class="alert alert-success mb-3" th:text="${successMessage}">
                            </div>
                            <div th:if="${errorMessage}" class="alert alert-danger mb-3" th:text="${errorMessage}">
                            </div>

                            <div class="d-flex align-items-start justify-content-between mb-3">
                                <div>
                                    <h2 class="mb-1">Chi tiết phản hồi</h2>
                                    <div class="small text-muted">
                                        ID: <span th:text="*{id}">0</span>
                                        • Tạo lúc <span
                                            th:text="${#temporals.format(feedback.createdAt, 'dd/MM/yyyy HH:mm')}">--/--/----
                                            --:--</span>
                                    </div>
                                </div>
                                <span class="badge" th:classappend="*{read} ? 'bg-success' : 'bg-danger'"
                                    th:text="*{read} ? 'ĐÃ ĐỌC' : 'CHƯA ĐỌC'">CHƯA ĐỌC</span>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label text-muted mb-1">Người dùng</label>
                                    <div class="fw-semibold">
                                        <span th:text="*{user != null ? user.username : '—'}">username</span>
                                        <span class="text-muted" th:text="*{user != null ? ' (#' + user.id + ')' : ''}">
                                            (#1)</span>
                                    </div>
                                    <div class="small text-muted" th:text="*{user != null ? user.email : ''}">
                                        email@example.com</div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label text-muted mb-1">Loại phản hồi</label><br />
                                    <span class="badge bg-secondary" th:text="*{targetType}">MOOD_ENTRY</span>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label text-muted mb-1">Target ID</label>
                                    <div class="fw-semibold" th:text="*{targetId}">0</div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label text-muted mb-1">Phân loại</label><br />
                                    <span class="badge bg-primary"
                                        th:text="*{satisfyLevel != null ? satisfyLevel.label : '—'}">NORMAL</span>
                                </div>
                            </div>

                            <div class="mb-2">
                                <label class="form-label text-muted mb-1">Nội dung phản hồi</label>
                                <div class="border rounded p-3 bg-light"
                                    style="white-space: pre-wrap; min-height: 80px;" th:text="*{content}">—</div>
                            </div>

                            <div class="mb-2">
                                <label class="form-label text-muted mb-1">Nội dung gốc</label>
                                <div class="border rounded p-3 bg-light"
                                    style="white-space: pre-wrap; min-height: 80px;" th:text="${originContent.content}">
                                    —</div>
                            </div>

                            <hr class="my-4" />

                            <div class="d-flex justify-content-between">
                                <a class="btn btn-outline-secondary" th:href="@{/feedbacks}">
                                    Quay lại
                                </a>

                                <form th:if="*{!read}" th:action="@{|/feedbacks/${feedback.id}/read|}" method="post"
                                    class="m-0">
                                    <button type="submit" class="btn btn-primary">Đánh dấu đã đọc</button>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="~{base :: mdb_script}"></div>
    <div th:replace="~{base :: main_scripts}"></div>
</body>

</html>